# إضافة نظام التسعير للكورسات

## نظرة عامة
تم إضافة نظام تسعير متكامل للكورسات يتضمن السعر الأساسي، العملة، الخصم، وخيار الكورس المجاني.

## الحقول المضافة

### 1. حقول قاعدة البيانات
- `price` (decimal, 10,2) - السعر الأساسي للكورس
- `currency` (string, 10) - العملة (USD, SAR, AED, EUR)
- `discount_percentage` (decimal, 5,2) - نسبة الخصم
- `is_free` (boolean) - هل الكورس مجاني

### 2. النموذج (Course Model)
تم تحديث `app/Models/Course.php` بإضافة:

#### الحقول القابلة للتعديل:
```php
protected $fillable = [
    'title', 
    'description', 
    'credit_hours', 
    'price',
    'currency',
    'discount_percentage',
    'is_free',
    'status', 
    'category_id'
];
```

#### Type Casting:
```php
protected $casts = [
    'price' => 'decimal:2',
    'discount_percentage' => 'decimal:2',
    'is_free' => 'boolean',
];
```

#### Accessor Methods:
- `getFinalPriceAttribute()` - السعر النهائي بعد الخصم
- `getFormattedPriceAttribute()` - السعر المنسق للعرض
- `getFormattedOriginalPriceAttribute()` - السعر الأصلي المنسق
- `hasDiscount()` - هل يوجد خصم
- `getDiscountAmountAttribute()` - قيمة الخصم

## التحكم (Controller)

### CourseController
تم تحديث `app/Http/Controllers/Admin/Educational/CourseController.php`:

#### Validation Rules:
```php
'price' => 'nullable|numeric|min:0|max:999999.99',
'currency' => 'nullable|string|max:10',
'discount_percentage' => 'nullable|numeric|min:0|max:100',
'is_free' => 'nullable|boolean',
```

#### Logic:
- إذا كان الكورس مجاني، يتم تعيين السعر والخصم إلى 0
- العملة الافتراضية هي USD
- نسبة الخصم الافتراضية هي 0

## الواجهات (Views)

### 1. صفحة إنشاء الكورس
**الملف**: `resources/views/admin/educational-courses/create.blade.php`

#### الميزات:
- ✅ خيار "كورس مجاني"
- ✅ حقل السعر مع العملة
- ✅ حقل نسبة الخصم
- ✅ عرض السعر النهائي المحدث تلقائياً
- ✅ JavaScript لحساب السعر النهائي

### 2. صفحة تعديل الكورس
**الملف**: `resources/views/admin/educational-courses/edit.blade.php`

#### الميزات:
- ✅ نفس ميزات صفحة الإنشاء
- ✅ عرض البيانات الحالية
- ✅ تحديث السعر النهائي تلقائياً

### 3. صفحة عرض الكورس
**الملف**: `resources/views/admin/educational-courses/show.blade.php`

#### الميزات:
- ✅ عرض السعر الأساسي
- ✅ عرض السعر بعد الخصم
- ✅ عرض نسبة الخصم
- ✅ تمييز الكورسات المجانية

### 4. صفحة قائمة الكورسات
**الملف**: `resources/views/admin/educational-courses/index.blade.php`

#### الميزات:
- ✅ عمود السعر في الجدول
- ✅ عرض السعر الأصلي والمخفض
- ✅ تمييز الكورسات المجانية
- ✅ عرض نسبة الخصم
- ✅ **مودال التعديل المحدث** مع جميع حقول السعر
- ✅ JavaScript لحساب السعر النهائي في المودال

## التحديثات الأخيرة (إصلاح مودال التعديل)

### المشكلة:
كان مودال التعديل في صفحة index لا يحتوي على حقول السعر والخصائص المطلوبة.

### الحل:
1. **تحديث مودال التعديل**:
   - إضافة قسم "Pricing Information" كامل
   - إضافة خيار "كورس مجاني"
   - إضافة حقول السعر والعملة ونسبة الخصم
   - إضافة عرض السعر النهائي

2. **تحديث JavaScript**:
   - إضافة دالة `setupPriceCalculation()` لكل مودال
   - إضافة event listeners لحساب السعر النهائي
   - إضافة toggle لحقول السعر عند اختيار "كورس مجاني"

3. **تحسينات الواجهة**:
   - تغيير حجم المودال إلى `modal-xl` لاستيعاب الحقول الجديدة
   - تحسين تخطيط الحقول
   - إضافة validation messages

### الميزات الجديدة في المودال:
- ✅ خيار "This course is free"
- ✅ حقل السعر مع step="0.01"
- ✅ اختيار العملة (USD, SAR, AED, EUR)
- ✅ حقل نسبة الخصم مع input group
- ✅ عرض السعر النهائي المحدث تلقائياً
- ✅ إخفاء/إظهار حقول السعر حسب خيار "كورس مجاني"

## كيفية الاستخدام

### 1. إنشاء كورس جديد
1. انتقل إلى صفحة إنشاء كورس جديد
2. املأ البيانات الأساسية
3. في قسم "Pricing Information":
   - اختر "This course is free" إذا كان الكورس مجاني
   - أو أدخل السعر والعملة
   - أدخل نسبة الخصم (اختياري)
4. سيتم عرض السعر النهائي تلقائياً
5. احفظ الكورس

### 2. تعديل كورس موجود (من صفحة القائمة)
1. انقر على أيقونة التعديل في الجدول
2. في مودال التعديل، ستجد قسم "Pricing Information"
3. عدل بيانات السعر كما تريد
4. سيتم تحديث السعر النهائي تلقائياً
5. احفظ التعديلات

### 3. تعديل كورس موجود (من صفحة التعديل)
1. انتقل إلى صفحة تعديل الكورس
2. عدل بيانات السعر كما تريد
3. سيتم تحديث السعر النهائي تلقائياً
4. احفظ التعديلات

### 4. عرض معلومات السعر
- في صفحة تفاصيل الكورس: ستجد قسم السعر مع جميع التفاصيل
- في قائمة الكورسات: عمود السعر يعرض السعر النهائي

## أمثلة على الأسعار

### كورس مجاني:
```
Free
```

### كورس بسعر عادي:
```
$99.99 USD
```

### كورس مع خصم:
```
~~$199.99 USD~~ (السعر الأصلي)
$149.99 USD (السعر النهائي)
25% OFF (نسبة الخصم)
```

## Migration

تم إنشاء migration جديد:
```bash
php artisan make:migration add_price_fields_to_courses_table --table=courses
```

**الملف**: `database/migrations/2025_06_21_191455_add_price_fields_to_courses_table.php`

## التحقق من التثبيت

1. تأكد من تشغيل الـ migration:
```bash
php artisan migrate
```

2. تحقق من وجود الحقول في قاعدة البيانات:
```sql
DESCRIBE courses;
```

3. اختبر إنشاء كورس جديد مع السعر

4. اختبر تعديل كورس موجود من صفحة القائمة

5. اختبر تعديل كورس موجود من صفحة التعديل

## ملاحظات مهمة

- الكورسات الموجودة ستحصل على قيم افتراضية (السعر 0، العملة USD)
- يمكن تحديث الكورسات الموجودة لإضافة الأسعار
- النظام يدعم العملات المتعددة
- الخصم اختياري ويمكن أن يكون 0%
- الكورسات المجانية لا تحتاج لسعر أو خصم
- **مودال التعديل يعمل الآن بشكل كامل مع جميع خصائص السعر**

## الدعم

لأي استفسارات أو مشاكل، يرجى التواصل مع فريق التطوير. 