# ميزة حالة التخرج للطلاب

## 📋 نظرة عامة
تم إضافة ميزة جديدة لإدارة حالة التخرج للطلاب في نظام Nextro. هذه الميزة تسمح للمدير بتحديد الطلاب كمتخرجين أو غير متخرجين، مع إمكانية الفلترة والبحث.

## 🚀 الميزات المضافة

### 1. حقل حالة التخرج
- تم إضافة حقل `is_graduated` في جدول `users`
- القيمة الافتراضية: `false` (غير متخرج)
- يمكن تغييرها إلى `true` (متخرج)

### 2. زر تغيير الحالة
- زر ديناميكي لكل طالب لتغيير حالة التخرج
- تأكيد قبل التغيير
- تحديث فوري للواجهة بدون إعادة تحميل الصفحة
- إشعارات نجاح/فشل

### 3. فلترة متقدمة
- فلترة حسب حالة التخرج (متخرج/غير متخرج)
- فلترة حسب حالة الحساب (نشط/معطل)
- بحث في الاسم، البريد الإلكتروني، رقم الطالب
- إمكانية الجمع بين الفلاتر

### 4. إحصائيات محدثة
- عرض عدد الطلاب المتخرجين
- نسبة الطلاب المتخرجين من إجمالي الطلاب
- إحصائيات ديناميكية

## 🛠️ التحديثات التقنية

### 1. قاعدة البيانات
```sql
-- إضافة حقل is_graduated
ALTER TABLE users ADD COLUMN is_graduated BOOLEAN DEFAULT FALSE;
```

### 2. النموذج (Model)
```php
// إضافة الحقل إلى fillable
protected $fillable = [
    // ... الحقول الموجودة
    'is_graduated',
];

// إضافة methods جديدة
public function isGraduated()
{
    return $this->is_graduated === true;
}

public function toggleGraduationStatus()
{
    $this->is_graduated = !$this->is_graduated;
    $this->save();
    return $this->is_graduated;
}
```

### 3. Controller
```php
// إضافة method لتغيير حالة التخرج
public function toggleGraduation($id)
{
    // تغيير الحالة وإرجاع JSON response
}

// تحديث method index للفلترة
public function index(Request $request)
{
    // فلترة حسب graduation_status
    // فلترة حسب account_status
    // فلترة حسب البحث
}
```

### 4. Routes
```php
// إضافة route جديد
Route::post('/{id}/toggle-graduation', [StudentController::class, 'toggleGraduation'])
    ->name('toggle-graduation');
```

## 🎨 واجهة المستخدم

### 1. جدول الطلاب
- عمود جديد "حالة التخرج"
- badge ملون (أصفر للمتخرج، أزرق لغير المتخرج)
- زر تغيير الحالة مع أيقونة مناسبة

### 2. الفلترة
- قائمة منسدلة لحالة التخرج
- قائمة منسدلة لحالة الحساب
- حقل بحث
- أزرار فلترة وإلغاء

### 3. الإحصائيات
- تحديث الإحصائيات لتشمل الطلاب المتخرجين
- نسب مئوية ديناميكية

## 📱 JavaScript Features

### 1. AJAX Requests
```javascript
// تغيير حالة التخرج
fetch(`/admin/accounts/students/${studentId}/toggle-graduation`, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRF-TOKEN': token
    }
})
```

### 2. Dynamic Updates
- تحديث badge الحالة
- تحديث زر التغيير
- تحديث الأيقونة
- إشعارات فورية

### 3. User Experience
- تأكيد قبل التغيير
- حالة تحميل أثناء الطلب
- رسائل نجاح/فشل
- تحديث فوري للواجهة

## 🔧 كيفية الاستخدام

### 1. تغيير حالة التخرج
1. انتقل إلى صفحة قائمة الطلاب
2. ابحث عن الطالب المطلوب
3. انقر على زر تغيير الحالة (أيقونة التخرج)
4. أكد التغيير في النافذة المنبثقة
5. ستظهر رسالة نجاح وتتحدث الحالة فوراً

### 2. فلترة الطلاب
1. استخدم قائمة "حالة التخرج" لفلترة الطلاب
2. اختر "متخرج" لعرض الطلاب المتخرجين فقط
3. اختر "غير متخرج" لعرض الطلاب غير المتخرجين
4. يمكن الجمع مع فلترة حالة الحساب

### 3. البحث
1. استخدم حقل البحث للبحث بالاسم أو البريد الإلكتروني
2. يمكن الجمع مع الفلاتر الأخرى

## 📊 الإحصائيات

### قبل التحديث
- إجمالي الطلاب: 1
- الطلاب المتخرجون: 0
- الطلاب غير المتخرجين: 1

### بعد التحديث
- تم إضافة حقل `is_graduated` لجميع الطلاب
- جميع الطلاب الموجودين تم تعيينهم كغير متخرجين افتراضياً
- يمكن تغيير الحالة من خلال الواجهة

## 🚀 الملفات المحدثة

1. **Migration**: `2025_07_25_125846_add_is_graduated_to_users_table.php`
2. **Model**: `app/Models/User.php`
3. **Controller**: `app/Http/Controllers/Admin/Accounts/StudentController.php`
4. **View**: `resources/views/admin/accounts/Student/index.blade.php`
5. **Routes**: `routes/web.php`
6. **Seeder**: `database/seeders/UpdateStudentsGraduationStatusSeeder.php`

## ⚠️ ملاحظات مهمة

1. **النسخ الاحتياطية**: تأكد من عمل نسخة احتياطية قبل تشغيل الـ migration
2. **التوافق**: الميزة متوافقة مع جميع المتصفحات الحديثة
3. **الأمان**: تم إضافة CSRF protection لجميع الطلبات
4. **الأداء**: تم تحسين الاستعلامات للفلترة

## 🎯 النتيجة النهائية

بعد تطبيق هذه التحديثات، ستتمكن من:
- تحديد الطلاب كمتخرجين أو غير متخرجين
- فلترة الطلاب حسب حالة التخرج
- البحث في الطلاب مع فلترة متقدمة
- رؤية إحصائيات ديناميكية للطلاب المتخرجين
- تغيير الحالة بسهولة من خلال واجهة سهلة الاستخدام 