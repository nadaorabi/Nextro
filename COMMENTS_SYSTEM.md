# نظام التعليقات والمرفقات للمدرسين

## نظرة عامة

تم تطوير نظام تعليقات شامل يسمح للمدرسين بإضافة تعليقات نصية ومرفقات على واجبات واختبارات الطلاب. هذا النظام يوفر وسيلة فعالة للتواصل بين المدرس والطالب مع إمكانية رفع ملفات داعمة.

## الميزات الرئيسية

### 1. إضافة التعليقات
- **نص التعليق**: إمكانية كتابة تعليق نصي يصل إلى 2000 حرف
- **المرفقات**: رفع ملفات داعمة (PDF, DOC, DOCX, JPG, JPEG, PNG)
- **حجم الملف**: الحد الأقصى 10 ميجابايت لكل مرفق
- **التوثيق**: تسجيل المدرس والتاريخ تلقائياً

### 2. عرض التعليقات
- **ترتيب زمني**: عرض التعليقات من الأحدث إلى الأقدم
- **معلومات المدرس**: عرض اسم وصورة المدرس
- **المرفقات**: عرض معلومات المرفق مع إمكانية التحميل
- **التفاعل**: إمكانية حذف التعليقات

### 3. إدارة الملفات
- **التخزين الآمن**: حفظ الملفات في مجلد `storage/app/public/comments/`
- **أسماء فريدة**: تسمية الملفات بشكل فريد لتجنب التعارض
- **التحميل**: إمكانية تحميل المرفقات من قبل المدرس

## البنية التقنية

### قاعدة البيانات

#### جدول `submission_comments`
```sql
- id (Primary Key)
- submission_type (enum: 'assignment', 'exam')
- submission_id (رقم الواجب أو الاختبار)
- student_id (رقم الطالب)
- teacher_id (رقم المدرس)
- comment (نص التعليق)
- attachment_file (اسم الملف المرفق - اختياري)
- attachment_type (نوع الملف)
- attachment_size (حجم الملف)
- commented_at (تاريخ التعليق)
- created_at, updated_at
```

### النماذج (Models)

#### SubmissionComment
- **العلاقات**: مع الطالب، المدرس، الواجب، الاختبار
- **الخصائص**: تنسيق حجم الملف، التحقق من وجود مرفق
- **الحماية**: حقول قابلة للتعديل محددة

### الكنترولر (Controller)

#### GradingController
- `addAssignmentComment()`: إضافة تعليق على واجب
- `addExamComment()`: إضافة تعليق على اختبار
- `downloadCommentAttachment()`: تحميل مرفق التعليق
- `deleteComment()`: حذف تعليق

### الـ Routes

```php
// إضافة تعليقات
POST teacher/grading/assignments/{assignment}/submissions/{submission}/comments
POST teacher/grading/exams/{exam}/submissions/{submission}/comments

// تحميل وحذف التعليقات
GET teacher/grading/comments/{comment}/attachment
DELETE teacher/grading/comments/{comment}
```

## الواجهات (Views)

### comments-section.blade.php
- **عرض التعليقات**: قائمة التعليقات مع المرفقات
- **نموذج الإضافة**: نموذج لإضافة تعليق جديد
- **التفاعل**: أزرار التحميل والحذف

### التكامل مع صفحات التصحيح
- **assignment.blade.php**: إضافة قسم التعليقات
- **exam.blade.php**: إضافة قسم التعليقات

## الترجمات

### الإنجليزية (lang/en/grading.php)
```php
'comment_added' => 'Comment added successfully.',
'comment_deleted' => 'Comment deleted successfully.',
'add_comment' => 'Add Comment',
'comments' => 'Comments',
// ... المزيد من الترجمات
```

### العربية (lang/ar/grading.php)
```php
'comment_added' => 'تم إضافة التعليق بنجاح.',
'comment_deleted' => 'تم حذف التعليق بنجاح.',
'add_comment' => 'إضافة تعليق',
'comments' => 'التعليقات',
// ... المزيد من الترجمات
```

## الأمان والصلاحيات

### التحقق من الصلاحيات
- **ملكية الواجب/الاختبار**: التحقق من أن المدرس يملك الواجب أو الاختبار
- **ملكية التعليق**: التحقق من أن المدرس يملك التعليق قبل الحذف
- **التحقق من الملفات**: التحقق من وجود الملف قبل التحميل

### حماية الملفات
- **أنواع مسموحة**: PDF, DOC, DOCX, JPG, JPEG, PNG
- **حجم محدود**: 10 ميجابايت كحد أقصى
- **تسمية آمنة**: أسماء فريدة للملفات

## الاستخدام

### للمدرسين

1. **الوصول لصفحة التصحيح**:
   ```
   /teacher/grading/assignments/{assignment}/submissions/{submission}
   /teacher/grading/exams/{exam}/submissions/{submission}
   ```

2. **إضافة تعليق**:
   - كتابة نص التعليق في الحقل المخصص
   - رفع ملف مرفق (اختياري)
   - الضغط على "إرسال التعليق"

3. **إدارة التعليقات**:
   - تحميل المرفقات
   - حذف التعليقات (مع تأكيد)

### للطلاب (في المستقبل)
- عرض التعليقات على واجباتهم واختباراتهم
- تحميل المرفقات المرفقة بالتعليقات

## التطوير المستقبلي

### الميزات المقترحة
1. **إشعارات**: إرسال إشعارات للطلاب عند إضافة تعليق
2. **الردود**: إمكانية رد الطالب على التعليقات
3. **التصنيف**: تصنيف التعليقات (نصيحة، تصحيح، ملاحظة)
4. **البحث**: البحث في التعليقات
5. **التصدير**: تصدير التعليقات كملف PDF

### التحسينات التقنية
1. **التخزين السحابي**: رفع الملفات على خدمات سحابية
2. **الضغط**: ضغط الملفات الكبيرة
3. **المعاينة**: معاينة الملفات قبل التحميل
4. **التحديث**: إمكانية تعديل التعليقات

## الصيانة

### الملفات المطلوب مراقبتها
- `storage/app/public/comments/`: مجلد المرفقات
- `submission_comments` table: جدول التعليقات

### التنظيف الدوري
- حذف الملفات المرفقة للتعليقات المحذوفة
- تنظيف الملفات المؤقتة
- مراجعة حجم التخزين

## الدعم والمساعدة

في حالة وجود أي مشاكل أو استفسارات:
1. مراجعة سجلات الأخطاء في `storage/logs/`
2. التحقق من صلاحيات المجلدات
3. التأكد من وجود رابط التخزين الرمزي
4. مراجعة إعدادات PHP للملفات الكبيرة

---

**تم تطوير هذا النظام بواسطة فريق Nextro التعليمي**
**تاريخ التطوير: يوليو 2025** 