# نظام التعليقات العامة للواجبات والاختبارات

## نظرة عامة

تم تطوير نظام تعليقات عامة يسمح للمدرسين بإضافة تعليقات ومرفقات على مستوى الواجب أو الاختبار نفسه، وليس فقط على حل طالب معين. هذه التعليقات تكون مرئية لجميع الطلاب المسجلين في الواجب أو الاختبار.

## الميزات الرئيسية

### 1. التعليقات العامة
- **نص التعليق**: إمكانية كتابة تعليق نصي يصل إلى 2000 حرف
- **المرفقات**: رفع ملفات داعمة (PDF, DOC, DOCX, JPG, JPEG, PNG)
- **حجم الملف**: الحد الأقصى 10 ميجابايت لكل مرفق
- **الرؤية**: التعليق مرئي لجميع الطلاب المسجلين

### 2. إدارة التعليقات
- **التعديل**: إمكانية تعديل التعليق العام
- **الحذف**: إمكانية حذف التعليق العام مع المرفق
- **التحميل**: تحميل المرفقات العامة
- **التوثيق**: تسجيل المدرس والتاريخ تلقائياً

### 3. التكامل مع النظام الحالي
- **التعليقات الفردية**: لا تزال متاحة للطلاب الفرديين
- **التعليقات العامة**: إضافة جديدة للواجب/الاختبار ككل
- **الواجهات**: تكامل سلس مع الواجهات الموجودة

## البنية التقنية

### قاعدة البيانات

#### تحديث جدول `assignments`
```sql
- general_comment (text, nullable)
- comment_attachment (string, nullable)
- comment_attachment_type (string, nullable)
- comment_attachment_size (unsignedBigInteger, nullable)
- commented_at (timestamp, nullable)
```

#### تحديث جدول `exams`
```sql
- general_comment (text, nullable)
- comment_attachment (string, nullable)
- comment_attachment_type (string, nullable)
- comment_attachment_size (unsignedBigInteger, nullable)
- commented_at (timestamp, nullable)
```

### النماذج (Models)

#### تحديث Assignment و Exam
- **الخصائص الجديدة**: حقول التعليقات العامة
- **الدوال المساعدة**: التحقق من وجود تعليق، تنسيق حجم الملف
- **العلاقات**: مع المدرس (teacher)

### الكنترولر (Controller)

#### GradingController - الدوال الجديدة
- `addAssignmentGeneralComment()`: إضافة تعليق عام على واجب
- `addExamGeneralComment()`: إضافة تعليق عام على اختبار
- `downloadAssignmentGeneralAttachment()`: تحميل مرفق الواجب العام
- `downloadExamGeneralAttachment()`: تحميل مرفق الاختبار العام
- `deleteAssignmentGeneralComment()`: حذف التعليق العام للواجب
- `deleteExamGeneralComment()`: حذف التعليق العام للاختبار

### الـ Routes

```php
// التعليقات العامة للواجبات
POST teacher/grading/assignments/{assignment}/general-comment
GET teacher/grading/assignments/{assignment}/general-attachment
DELETE teacher/grading/assignments/{assignment}/general-comment

// التعليقات العامة للاختبارات
POST teacher/grading/exams/{exam}/general-comment
GET teacher/grading/exams/{exam}/general-attachment
DELETE teacher/grading/exams/{exam}/general-comment
```

## الواجهات (Views)

### general-comments-section.blade.php
- **عرض التعليق العام**: مع معلومات المدرس والتاريخ
- **المرفقات**: عرض معلومات المرفق مع إمكانية التحميل
- **نموذج الإضافة/التعديل**: نموذج لإضافة أو تعديل التعليق العام
- **التفاعل**: أزرار التحميل والحذف

### التكامل مع صفحات العرض
- **assignments/show.blade.php**: إضافة قسم التعليقات العامة
- **exams/show.blade.php**: إضافة قسم التعليقات العامة

## الترجمات

### الإنجليزية (lang/en/grading.php)
```php
'general_comment_added' => 'General comment added successfully.',
'general_comment_deleted' => 'General comment deleted successfully.',
'add_general_comment' => 'Add General Comment',
'general_comments' => 'General Comments',
'general_comment_for_all_students' => 'This comment will be visible to all students enrolled in this assignment/exam.',
// ... المزيد من الترجمات
```

### العربية (lang/ar/grading.php)
```php
'general_comment_added' => 'تم إضافة التعليق العام بنجاح.',
'general_comment_deleted' => 'تم حذف التعليق العام بنجاح.',
'add_general_comment' => 'إضافة تعليق عام',
'general_comments' => 'التعليقات العامة',
'general_comment_for_all_students' => 'هذا التعليق سيكون مرئياً لجميع الطلاب المسجلين في هذا الواجب/الاختبار.',
// ... المزيد من الترجمات
```

## الأمان والصلاحيات

### التحقق من الصلاحيات
- **ملكية الواجب/الاختبار**: التحقق من أن المدرس يملك الواجب أو الاختبار
- **التحقق من الملفات**: التحقق من وجود الملف قبل التحميل
- **حماية الملفات**: أنواع محددة وأحجام محدودة

### حماية الملفات
- **أنواع مسموحة**: PDF, DOC, DOCX, JPG, JPEG, PNG
- **حجم محدود**: 10 ميجابايت كحد أقصى
- **تسمية آمنة**: أسماء فريدة للملفات

## الاستخدام

### للمدرسين

1. **الوصول لصفحة الواجب/الاختبار**:
   ```
   /teacher/assignments/{assignment}
   /teacher/exams/{exam}
   ```

2. **إضافة تعليق عام**:
   - كتابة نص التعليق في الحقل المخصص
   - رفع ملف مرفق (اختياري)
   - الضغط على "إرسال التعليق العام"

3. **إدارة التعليقات العامة**:
   - تحميل المرفقات
   - حذف التعليقات (مع تأكيد)
   - تعديل التعليقات

### للطلاب (في المستقبل)
- عرض التعليقات العامة على واجباتهم واختباراتهم
- تحميل المرفقات العامة المرفقة بالتعليقات

## الفرق بين التعليقات

### التعليقات الفردية (Submission Comments)
- **المستوى**: على حل طالب معين
- **الرؤية**: للطالب المحدد فقط
- **الاستخدام**: ملاحظات خاصة، تصحيح فردي

### التعليقات العامة (General Comments)
- **المستوى**: على الواجب/الاختبار ككل
- **الرؤية**: لجميع الطلاب المسجلين
- **الاستخدام**: تعليمات عامة، توضيحات، نماذج إجابة

## التطوير المستقبلي

### الميزات المقترحة
1. **إشعارات**: إرسال إشعارات للطلاب عند إضافة تعليق عام
2. **التصنيف**: تصنيف التعليقات (تعليمات، توضيحات، تصحيحات)
3. **البحث**: البحث في التعليقات العامة
4. **التصدير**: تصدير التعليقات كملف PDF
5. **التحديث**: إمكانية تعديل التعليقات العامة

### التحسينات التقنية
1. **التخزين السحابي**: رفع الملفات على خدمات سحابية
2. **الضغط**: ضغط الملفات الكبيرة
3. **المعاينة**: معاينة الملفات قبل التحميل
4. **الإصدارات**: تتبع إصدارات التعليقات

## الصيانة

### الملفات المطلوب مراقبتها
- `storage/app/public/general-comments/`: مجلد المرفقات العامة
- `assignments` table: جدول الواجبات مع التعليقات
- `exams` table: جدول الاختبارات مع التعليقات

### التنظيف الدوري
- حذف الملفات المرفقة للتعليقات المحذوفة
- تنظيف الملفات المؤقتة
- مراجعة حجم التخزين

## الدعم والمساعدة

في حالة وجود أي مشاكل أو استفسارات:
1. مراجعة سجلات الأخطاء في `storage/logs/`
2. التحقق من صلاحيات المجلدات
3. التأكد من وجود رابط التخزين الرمزي
4. مراجعة إعدادات PHP للملفات الكبيرة

---

**تم تطوير هذا النظام بواسطة فريق Nextro التعليمي**
**تاريخ التطوير: يوليو 2025** 